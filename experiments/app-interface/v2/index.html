<!DOCTYPE html>
<html lang="en">

<head>
    <!-- <base href="./"> -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no"> -->
    <meta name="description" content="Grace London live stream app">
    <meta name="author" content="W.A. (Andries) Salm">
    <meta name="keyword" content="Grace London live stream app">
    <title>Grace London live stream app</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/simple-line-icons/2.4.1/css/simple-line-icons.css">


    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/mdbootstrap/4.14.0/css/mdb.min.css" rel="stylesheet"> -->

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Libre+Baskerville&display=swap" rel="stylesheet">

    <link href="assets/stylesheets/site.css" rel="stylesheet">
    <link href="assets/stylesheets/main.css" rel="stylesheet">
    <link href="assets/stylesheets/card-right.css" rel="stylesheet">
    <link href="assets/stylesheets/card-left.css" rel="stylesheet">
    <link href="assets/stylesheets/settings.css" rel="stylesheet">
    
</head>

<!--

    class main states : 
        - (none): normal paused
        - running: running mode
        - invalid: error mode
        - settings: settings screen

-->
<body class="app">
    <div class="mask">
    <div class="main" id="main">
        <div class="card-group" id='settings'>
            <div class="card">
                <div class="card-body py-5 p-4 lhs">
                    TEST
                </div>
            </div>
        </div>
        <div class="card-group">
            <div class="card" id='qrcode-bg'>
                <div class="card-body py-5 p-4 lhs">
                    <div class="row hide-when-running">
                        <div class="col-12">
                            <button class="btn btn-sm btn-outline-secondary float-right" type="button" id="settingsBtn"><i class="icon-settings"></i> Settings</button>
                        </div>
                    </div>
                    <h1 class="hide-when-running">Live stream</h1>
                    <br/>

                    <label for="title" class="hide-when-running">Sermon title:</label>    
                    <div class="input-group mb-3 hide-when-running">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                              <i class="icon-bubble"></i>
                            </span>
                        </div>
                        <input class="form-control" type="text" placeholder="Title" id="title">
                    </div>

                    <div class="form-row hide-when-running">
                         <div class="form-group col-md-6">
                            <label for="title" class="hide-when-running">Spreaker:</label>    
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">
                                      <i class="icon-user"></i>
                                    </span>
                                </div>
                                <input class="form-control" type="text" placeholder="Name" id="speaker">
                            </div>
                         </div>

                         <div class="form-group col-md-6">
                            <label for="title" class="hide-when-running">Bible verse:</label>    
                            <div class="input-group">
                                <div class="input-group-prepend">
                                    <span class="input-group-text">
                                      <i class="icon-notebook"></i>
                                    </span>
                                </div>
                                <input class="form-control" type="text" placeholder="Book and chapter" id="bible-text">
                            </div>
                         </div>
                     </div>

                    <label for="select1" class="hide-when-running">Audio device:</label>    
                    <div class="input-group mb-4 hide-when-running">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                              <i class="icon-volume-1"></i>
                            </span>
                        </div>
                        <select class="form-control" id="select-printer" name="select-printer">
                            <option value="-1">No audio devices found</option>
                        </select>
                        <div class="input-group-append">
                            <button class="btn btn-outline-danger" type="button" id="refreshBtn">
                                <i class="icon-refresh"></i>
                            </button>
                        </div>
                    </div>
                    <div class="text-center">
                        <button class="btn btn-outline-danger btn-grace-large" type="button" id="startBtn" >
                            <div class="remove-when-running">
                                Start stream
                            </div>
                            <div class="add-when-running">
                                Stop stream
                            </div
                        </button>
                    </div>
                </div>
                <!-- <div class="card-body py-5 p-4" id='logincard'>
                    <h1>Login</h1>
                    <p class="text-muted">Sign in with your MACS linux account details</p>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                              <i class="icon-user"></i>
                            </span>
                        </div>
                        <input class="form-control" type="text" placeholder="Username" id="username">
                    </div>
                    <div class="input-group mb-3">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                              <i class="icon-lock"></i>
                            </span>
                        </div>
                        <input class="form-control" type="password" placeholder="Password" id="password">
                    </div>
                    <div class="input-group mb-4">
                        <div class="form-check form-check-inline mr-1">
                          <input class="form-check-input" id="save-credentials" type="checkbox">
                          <label class="form-check-label" for="save-credentials">Save credentials</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-6">
                            <button class="btn btn-primary px-4" type="button" id="loginBtn">Login</button>
                        </div>
                        <div class="col-6 text-right">
                            <button class="btn btn-link px-0" type="button" id="forgetBtn">Forgot password?</button>
                        </div>
                    </div>
                </div> -->
                <!-- <div class="card-body" id="printercard">
                    <div class="row">
                        <div class="col-12">
                            <button class="btn btn-close btn-sm btn-danger float-right" type="button" id="logoffBtn" style="margin-bottom: 15px;"><i class="icon-close"></i> Logoff</button>
                        </div>
                    </div>
                    <h1>Printer enabled</h1>
                    <br/>
                    <label for="select1">Select Printer:</label>    
                    <div class="input-group mb-4">
                        <div class="input-group-prepend">
                            <span class="input-group-text">
                              <i class="icon-printer"></i>
                            </span>
                        </div>
                        <select class="form-control" id="select-printer" name="select-printer">
                            <option value="-1">No Printers found</option>
                        </select>
                    </div>
                </div>
                <div class="card-footer" id='statusbar'>
                    <span id="isPrinting"><i class="icon-drawer"></i>&nbsp;&nbsp;&nbsp;Printer is ready on ipp://localhost:1631</span>
                    <span id="isNotPrinting"><i class="icon-layers"></i>&nbsp;&nbsp;&nbsp;Printing...</span>
                </div> -->
            </div>
            <div class="card text-white rhs">
                <div class="mask"></div>
                <div class="card-body" style="position: relative;">
                    <img src="assets/images/logo.png" alt="Logo" class="logo" />
                    <p class='rhs-invalid-msg'>An error occurred. Check your credentials<br/> and your network connection.</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/qrjs2@0.1.7/js/qrjs2.min.js"></script>
    <script type="text/javascript">
        // Temporary
        document.getElementById('refreshBtn').addEventListener('click', () => {
            document.getElementById('main').classList.add("invalid");
            document.getElementById('main').classList.remove("running");
            document.getElementById('main').classList.remove("settings");
        });

        document.getElementById('startBtn').addEventListener('click', () => {

            
            u = "http://wasalm-60086.portmap.io:60086/1234/index.html",
            s = QRCode.generateSVG(u, {
                    ecclevel: "M",
                    fillcolor: "#ffffff", //f2f2f2
                    textcolor: "#000000",
                    margin: 20, //15
                    modulesize: 6 //6
                });

            
            var XMLS = new XMLSerializer();
            s = XMLS.serializeToString(s);
            s = transformQRCode(s);

            s = "data:image/svg+xml;base64," + window.btoa(unescape(encodeURIComponent(s)));
            document.getElementById('qrcode-bg').style.backgroundImage = "url('" + s + "')";

            document.getElementById('main').classList.remove("invalid");
            document.getElementById('main').classList.add("running");
            document.getElementById('main').classList.remove("settings");
        });

        // document.getElementById('stopBtn').addEventListener('click', () => {
        //     document.getElementById('main').classList.remove("invalid");
        //     document.getElementById('main').classList.remove("running");
        //     document.getElementById('main').classList.remove("settings");
        // });

        document.getElementById('settingsBtn').addEventListener('click', () => {
            document.getElementById('main').classList.remove("invalid");
            document.getElementById('main').classList.remove("running");
            document.getElementById('main').classList.add("settings");
        });


        function transformQRCode(s) {

            //Replace colors
            s = s.replace("</style>", ".bg2{fill:#f2f2f2}</style><rect class=\"bg2\" fill=\"none\" x=\"0\" y=\"0\" width=\"1000\" height=\"1000\" mask=\"url(#mask)\"/><mask id='mask'>");
            s = s.replace("</svg>", "</mask></svg>");


            return s;
        }



        // const { ipcRenderer } = require('electron');
        // const { dialog } = require('electron').remote

        // /*
        //  *  Forgot password button click event
        //  */        
        // document.getElementById("forgetBtn").addEventListener("click", () => {
        //     dialog.showMessageBox({type: "info", buttons: ["Ok"], title: "MACS Printer bridge", message: "Forget password?", detail: "Please contact ICT for new login credentials."})
        // });

        // /*
        //  *  Login button click event
        //  */        
        // document.getElementById("loginBtn").addEventListener("click", () => {
        //     ipcRenderer.send('login', {
        //         //State for login card
        //         username: document.getElementById("username").value,
        //         password: document.getElementById("password").value,
        //         saveCredentials: document.getElementById("save-credentials").checked
        //     });
        // });

        // /*
        //  *  Logoff button click event
        //  */
        // document.getElementById("logoffBtn").addEventListener("click", () => {
        //     ipcRenderer.send('logoff');
        // });

        // /*
        //  *  change printer event
        //  */
        // document.getElementById("select-printer").addEventListener("change", () => {
        //     ipcRenderer.send('changePrinter', document.getElementById("select-printer").value);
        // });

        // /*
        //  *  State update event
        //  */
        // ipcRenderer.on("setState", (event, arg) => {
        //     updatePage(arg);
        // });

        // /*
        //  *  On load, request current state and then show it
        //  */
        // updatePage(ipcRenderer.sendSync('getState'));
        // ipcRenderer.send('show');

        /*
         *  Update the page with current status
         */
        // function updatePage(state) {
        //     //Default set right hand side(rhs) to valid state

        //     // Printer is always valid if logged in
        //     document.getElementById("rhs").classList.remove("invalid");
        //     // document.getElementById("rhs-valid-msg").style.display = "";
        //     document.getElementById("rhs-invalid-msg").style.display = "none";


        //     if (state.enabled) {
        //         //Show Printer Card
        //         document.getElementById("logincard").style.display = "none";
        //         document.getElementById("printercard").style.display = "";
        //         document.getElementById("statusbar").style.display = "";

        //         //Update Printer Card
        //         if(state.isPrinting) {
        //             document.getElementById("isPrinting").style.display = "none";
        //             document.getElementById("isNotPrinting").style.display = "";
        //         } else {
        //             document.getElementById("isPrinting").style.display = "";
        //             document.getElementById("isNotPrinting").style.display = "none";
        //         }

        //         let select = document.getElementById("select-printer");
        //         select.innerHTML = "";
        //         for(let i=0; i<state.printers.length; i++) {
        //             if(state.printers[i] == state.selectedPrinter) {
        //                 select.innerHTML += "<option value="+i+" selected>"+state.printers[i]+"</option>";
        //             } else {
        //                 select.innerHTML += "<option value="+i+">"+state.printers[i]+"</option>";
        //             }    
        //         }

        //     } else {
        //         //Show Login Card
        //         document.getElementById("logincard").style.display = "";
        //         document.getElementById("printercard").style.display = "none";
        //         document.getElementById("statusbar").style.display = "none";

        //         //Update Login Card
        //         document.getElementById("username").value = state.username;
        //         document.getElementById("password").value = state.password;
        //         document.getElementById("save-credentials").checked = state.saveCredentials;

        //         if(!state.isValid) {
        //             document.getElementById("rhs").classList.add("invalid");
        //             // document.getElementById("rhs-valid-msg").style.display = "none";
        //             document.getElementById("rhs-invalid-msg").style.display = "";
        //         } 
        //     }
        // }

        // updatePage({enabled: false, isValid: true, username: "asfasf", password: "safasf", saveCredentials: true});

        // document.getElementById("rhs").classList.add("qrcode");

        // var qrcode = new QRCode(document.getElementById("qrcode"), {
        //     text: "http://grace.london",
        //     width: 128,
        //     height: 128,
        //     colorDark : "#000000",
        //     colorLight : "#ffffff00",
        //     correctLevel : QRCode.CorrectLevel.H
        // });
    </script>
</body>

</html>